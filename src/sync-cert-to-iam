sync-cert-to-iam () {
    FILE_LIST="cert.pem privkey.pem chain.pem"
    DATE=`date '+%Y-%m-%d'`

    if ! type aws; then
        install-aws
    fi

    for SITE_NAME in $(list-sites)
    do
        echo "Uploading certificates for site: $SITE_NAME  -->  $SITE_NAME-$DATE"
        missing_certfile=0

        for cert_file in $FILE_LIST;
        do
            file_path="$LOCAL_PATH/$SITE_NAME/$cert_file"

            if [ ! -f $file_path ]; then
                echo " - Missing $cert_file"
                missing_certfile=1
            fi
        done

        if [ missing_certfile = 1 ]; then
            continue
        fi

        aws iam upload-server-certificate --server-certificate-name "$SITE_NAME-$DATE" --certificate-body "file:///$LOCAL_PATH/$SITE_NAME/cert.pem" --private-key "file:///$LOCAL_PATH/$SITE_NAME/privkey.pem" --certificate-chain "file:///$LOCAL_PATH/$SITE_NAME/chain.pem"
    done
}